<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problem 3: Multiple Evidence & Conditional Independence: The Spam Detector â€” Bayes' Theorem Complete Guide</title>
    <link rel="icon" type="image/png" href="images/favicon.png">    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.75;
            color: #1a202c;
            background-color: #f7fafc;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.08);
            padding: 48px 52px;
        }
        
        .content { max-width: 950px; margin: 0 auto; color: #1a202c; }
        .content h1 {
            color: #1a202c; margin: 32px 0 20px;
            padding-bottom: 12px;
            border-bottom: 4px solid #8b5cf6;
            font-size: 2.1em;
            font-weight: 700;
        }
        .content h2 {
            color: #1a202c; margin: 28px 0 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #a78bfa;
            font-size: 1.6em;
            font-weight: 600;
        }
        .content h3 { color: #1a202c; margin: 22px 0 12px; font-size: 1.3em; font-weight: 600; }
        .content h4 { color: #2d3748; margin: 18px 0 10px; font-size: 1.1em; font-weight: 600; }
        .content p  { margin-bottom: 16px; line-height: 1.8; color: #1a202c; }
        .content ul, .content ol { margin: 12px 0 18px 30px; color: #1a202c; }
        .content li { margin-bottom: 8px; line-height: 1.75; color: #1a202c; }
        .content hr { border: none; border-top: 2px solid #e2e8f0; margin: 26px 0; }
        .content pre {
            background: #f7fafc !important;
            border: 1px solid #cbd5e0 !important;
            border-left: 4px solid #8b5cf6 !important;
            padding: 18px !important; overflow-x: auto; margin: 18px 0; border-radius: 6px;
            font-family: 'Consolas','Monaco','Courier New',monospace !important;
            font-size: 0.9em !important;
        }
        .content pre:not([style*="color"]) { color: #1a202c !important; }
        .content code {
            font-family: 'Consolas','Monaco','Courier New',monospace !important;
            font-size: 0.88em !important;
        }
        .content code:not(pre code) {
            background: #ede9fe !important;
            color: #1a202c !important;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .content pre code { background: transparent !important; padding: 0; }
        .content table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .content th {
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            color: white; padding: 12px 16px; text-align: left;
            font-weight: 600;
        }
        .content td { padding: 11px 16px; border: 1px solid #e2e8f0; color: #1a202c; }
        .content tr:nth-child(even) td { background: #faf5ff; }
        .content blockquote {
            border-left: 4px solid #8b5cf6; background: #faf5ff;
            padding: 14px 20px; margin: 18px 0; border-radius: 0 6px 6px 0;
            color: #1a202c;
        }
        .content strong { color: #1a202c; font-weight: 600; }
        .px-2 { padding: 0; }
        .chat-message { background: transparent; padding: 0; margin: 0; }

        /* Bottom nav bar only */
        .nav-bar {
            display: flex; justify-content: space-between; align-items: center;
            padding: 24px 0;
            margin-top: 50px;
            border-top: 3px solid #a78bfa;
        }
        .nav-button {
            display: inline-flex; align-items: center; gap: 8px;
            padding: 12px 26px;
            background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            color: white !important; text-decoration: none;
            border-radius: 8px; font-weight: 600; font-size: 0.95em;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(139,92,246,0.35);
        }
        .nav-button:hover { transform: translateY(-2px); box-shadow: 0 4px 14px rgba(139,92,246,0.5); }
        .nav-button.disabled { background: #cbd5e1; box-shadow: none; pointer-events: none; }
        .nav-button.home {
            background: linear-gradient(135deg, #6366f1 0%, #818cf8 100%);
            box-shadow: 0 2px 8px rgba(99,102,241,0.35);
        }
        .nav-button.home:hover { box-shadow: 0 4px 14px rgba(99,102,241,0.5); }
        .page-info { color: #718096; font-size: 0.9em; text-align: center; }

        /* Progress bar */
        #progress-track {
            position: fixed; top: 20px; right: 20px;
            width: 10px; height: 150px;
            background: rgba(139,92,246,0.2);
            border: 2px solid #8b5cf6;
            border-radius: 6px; overflow: hidden; z-index: 1000;
        }
        #progress-fill {
            width: 100%;
            background: linear-gradient(180deg, #8b5cf6, #7c3aed);
            height: 0%;
            transition: height 0.15s ease;
        }
        #progress-pct {
            position: fixed; top: 0px; right: 16px;
            color: #7c3aed; font-size: 14px; font-weight: bold;
            z-index: 1001;
            text-shadow: 0 1px 2px rgba(255,255,255,0.9);
            line-height: 20px;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="content">
            <div class="chat-message" data-index="5">
<div class="px-2"><h1>BAYES' THEOREM â€” PROBLEM 3 OF 10</h1>
<h2>Multiple Evidence &amp; Conditional Independence: The Spam Detector</h2>
<hr>
<h2>ğŸ¯ DIFFICULTY: EASY (Building on Problems 1 &amp; 2)</h2>
<hr>
<h2>WHAT CHANGED FROM PREVIOUS PROBLEMS</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>Problem 1: 2 hypotheses, 1 evidence   â†’ Binary Bayes
</span>Problem 2: N hypotheses, 1 evidence   â†’ Multi-Hypothesis Bayes
Problem 3: 2 hypotheses, M evidences  â†’ Multiple Evidence Bayes

THE NEW CHALLENGE:
    â†’ Previously: ONE alarm, ONE test result
    â†’ Now: MULTIPLE features observed SIMULTANEOUSLY
    â†’ How do we handle P(Eâ‚, Eâ‚‚, Eâ‚ƒ | Hypothesis)?
    â†’ This joint likelihood is the NEW piece of machinery</code></pre></div>
<hr>
<h2>THE HYPOTHETICAL PROBLEM</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>You are building an email spam filter.
</span>An email just arrived with THREE observable features:

    Feature 1: Contains the word "FREE"          â†’ Yes
    Feature 2: Subject line is in ALL CAPS        â†’ Yes  
    Feature 3: Sender is in your contact list     â†’ No

From analyzing 10,000 past emails, you know:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Total emails analyzed:     10,000                          â”‚
    â”‚  Spam emails:               2,000  (20%)                    â”‚
    â”‚  Legitimate (Ham) emails:   8,000  (80%)                    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                                                              â”‚
    â”‚  AMONG SPAM EMAILS (2,000):                                 â”‚
    â”‚      Contains "FREE":         70%  (1,400 emails)           â”‚
    â”‚      ALL CAPS subject:        60%  (1,200 emails)           â”‚
    â”‚      Sender in contacts:      5%   (100 emails)             â”‚
    â”‚                                                              â”‚
    â”‚  AMONG LEGITIMATE EMAILS (8,000):                           â”‚
    â”‚      Contains "FREE":         10%  (800 emails)             â”‚
    â”‚      ALL CAPS subject:        5%   (400 emails)             â”‚
    â”‚      Sender in contacts:      80%  (6,400 emails)           â”‚
    â”‚                                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

QUESTION: Given all THREE features observed together,
          what is the probability this email is SPAM?</code></pre></div>
<hr>
<h2>HOW TO APPROACH IT</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>Step 1 â†’ Recognize: 2 hypotheses (Spam, Ham) â€” same as Problem 1 structure
</span>Step 2 â†’ Recognize: 3 pieces of evidence â€” NEW challenge
Step 3 â†’ Apply Bayes (as learned in Problems 1 &amp; 2):

                     P(Eâ‚,Eâ‚‚,Eâ‚ƒ | Spam) Ã— P(Spam)
    P(Spam|Eâ‚,Eâ‚‚,Eâ‚ƒ) = â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                P(Eâ‚,Eâ‚‚,Eâ‚ƒ)

Step 4 â†’ THE PROBLEM: What is P(Eâ‚,Eâ‚‚,Eâ‚ƒ | Spam)?
         â†’ This is the JOINT probability of ALL three features given Spam
         â†’ To compute this EXACTLY, we'd need data for every COMBINATION
         â†’ 3 binary features = 2Â³ = 8 combinations
         â†’ 10 binary features = 2Â¹â° = 1,024 combinations
         â†’ 50 binary features = 2âµâ° â‰ˆ 1 QUADRILLION combinations
         â†’ WE WILL NEVER HAVE ENOUGH DATA FOR THIS

Step 5 â†’ THE SOLUTION: Assume CONDITIONAL INDEPENDENCE
         â†’ This is the "NAIVE" assumption
         â†’ It makes the impossible computation POSSIBLE</code></pre></div>
<hr>
<h2>THE INDEPENDENCE ASSUMPTION â€” THE CORE NEW CONCEPT</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
</span>EXACT (INTRACTABLE) APPROACH:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

P(Eâ‚,Eâ‚‚,Eâ‚ƒ | Spam) = One single number from a giant lookup table
                     = Need to count emails that have ALL THREE
                       features simultaneously among spam
                     = Maybe 50 emails out of 2,000 have all three?
                     = Unreliable estimate from small count

PROBLEM:
    â†’ With M features, need 2á´¹ counts
    â†’ Most combinations have ZERO or very few examples
    â†’ Estimates are noisy and unreliable
    â†’ Called the "CURSE OF DIMENSIONALITY"


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
NAIVE (TRACTABLE) APPROACH:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ASSUME: Features are CONDITIONALLY INDEPENDENT given the class.

MEANING: Once you KNOW an email is spam, knowing it contains "FREE"
         tells you NOTHING EXTRA about whether it has ALL CAPS.

MATHEMATICALLY:

    P(Eâ‚,Eâ‚‚,Eâ‚ƒ | Spam) = P(Eâ‚|Spam) Ã— P(Eâ‚‚|Spam) Ã— P(Eâ‚ƒ|Spam)

    JOINT likelihood = PRODUCT of individual likelihoods

THIS CHANGES EVERYTHING:
    â†’ Instead of 2á´¹ numbers, need only M numbers per class
    â†’ Instead of 8 counts, need only 3 counts per class
    â†’ Each individual P(Eáµ¢|Class) is estimated from LOTS of data
    â†’ Reliable, stable, computable</code></pre></div>
<hr>
<h2>WHY "CONDITIONAL" INDEPENDENCE â€” NOT JUST "INDEPENDENCE"</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>THIS IS THE MOST MISUNDERSTOOD PART:
</span>
UNCONDITIONAL INDEPENDENCE:
    â†’ "FREE" and "ALL CAPS" are independent IN GENERAL
    â†’ This is probably FALSE
    â†’ Spammy emails tend to have BOTH features together

CONDITIONAL INDEPENDENCE:
    â†’ "FREE" and "ALL CAPS" are independent GIVEN YOU KNOW IT'S SPAM
    â†’ AMONG spam emails, knowing "FREE" is present doesn't change
      your estimate of whether "ALL CAPS" is present
    â†’ This is much more REASONABLE

ANALOGY:
    â†’ Height and vocabulary size are CORRELATED in general
      (both increase with age in children)
    â†’ But GIVEN a specific age, they are roughly independent
    â†’ Age is the "explaining away" variable â€” like Spam/Ham class

VISUAL:

    UNCONDITIONAL:          CONDITIONAL:
    
    "FREE" â†â”€â”€â†’ "CAPS"     Spam â†’ "FREE"
    (correlated)            Spam â†’ "CAPS"
                            (independent given Spam)

    The CLASS variable EXPLAINS the correlation.
    Once you condition on it, the features become independent.</code></pre></div>
<hr>
<h2>THE FULL NAIVE BAYES FORMULA</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>FOR TWO CLASSES (Spam, Ham) AND M FEATURES:
</span>
                         P(Spam) Ã— âˆáµ¢ P(Eáµ¢|Spam)
P(Spam|Eâ‚,...,Eâ‚˜) = â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                     P(Spam)Ã—âˆáµ¢P(Eáµ¢|Spam) + P(Ham)Ã—âˆáµ¢P(Eáµ¢|Ham)

WHERE:
    âˆáµ¢ means PRODUCT over all features i = 1 to M

THIS IS JUST:
    â†’ Problem 1's formula (binary Bayes)
    â†’ With the likelihood replaced by a PRODUCT of individual likelihoods
    â†’ The denominator follows the same pattern from Problem 2</code></pre></div>
<hr>
<h2>LABELING EVERY KNOWN QUANTITY</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>PRIORS (from Problem 1 â€” same concept):
</span>    P(Spam) = 2000/10000 = 0.20
    P(Ham)  = 8000/10000 = 0.80

INDIVIDUAL LIKELIHOODS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Feature            â”‚ P(Eáµ¢|Spam)  â”‚ P(Eáµ¢|Ham)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Eâ‚: "FREE" present  â”‚    0.70      â”‚    0.10      â”‚
â”‚ Eâ‚‚: ALL CAPS        â”‚    0.60      â”‚    0.05      â”‚
â”‚ Eâ‚ƒ: In contacts     â”‚    0.05      â”‚    0.80      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

OBSERVED EVIDENCE FOR THIS EMAIL:
    Eâ‚ = Yes (contains "FREE")
    Eâ‚‚ = Yes (ALL CAPS)
    Eâ‚ƒ = No  (sender NOT in contacts)

THEREFORE WE USE:
    For Spam: P(Eâ‚=Yes|Spam) Ã— P(Eâ‚‚=Yes|Spam) Ã— P(Eâ‚ƒ=No|Spam)
    For Ham:  P(Eâ‚=Yes|Ham)  Ã— P(Eâ‚‚=Yes|Ham)  Ã— P(Eâ‚ƒ=No|Ham)

NOTE ON Eâ‚ƒ:
    P(Eâ‚ƒ=No|Spam) = 1 - P(Eâ‚ƒ=Yes|Spam) = 1 - 0.05 = 0.95
    P(Eâ‚ƒ=No|Ham)  = 1 - P(Eâ‚ƒ=Yes|Ham)  = 1 - 0.80 = 0.20</code></pre></div>
<hr>
<h2>THE FULL CALCULATION â€” STEP BY STEP</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
</span>STEP 1: COMPUTE JOINT LIKELIHOOD FOR SPAM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

P(Eâ‚=Y,Eâ‚‚=Y,Eâ‚ƒ=N | Spam) = P(Eâ‚=Y|Spam) Ã— P(Eâ‚‚=Y|Spam) Ã— P(Eâ‚ƒ=N|Spam)
                            = 0.70 Ã— 0.60 Ã— 0.95
                            = 0.399


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 2: COMPUTE JOINT LIKELIHOOD FOR HAM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

P(Eâ‚=Y,Eâ‚‚=Y,Eâ‚ƒ=N | Ham)  = P(Eâ‚=Y|Ham) Ã— P(Eâ‚‚=Y|Ham) Ã— P(Eâ‚ƒ=N|Ham)
                            = 0.10 Ã— 0.05 Ã— 0.20
                            = 0.001


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 3: COMPUTE NUMERATORS (same pattern as Problem 2)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Numerator_Spam = P(Spam) Ã— P(Evidence|Spam) = 0.20 Ã— 0.399 = 0.0798
Numerator_Ham  = P(Ham)  Ã— P(Evidence|Ham)  = 0.80 Ã— 0.001 = 0.0008


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 4: COMPUTE DENOMINATOR (from Problem 2)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

P(Evidence) = 0.0798 + 0.0008 = 0.0806


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 5: COMPUTE POSTERIORS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

P(Spam|Evidence) = 0.0798 / 0.0806 = 0.99008 â‰ˆ 99.01%
P(Ham|Evidence)  = 0.0008 / 0.0806 = 0.00992 â‰ˆ 0.99%


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 6: VERIFY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

0.99008 + 0.00992 = 1.00000  âœ“


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CONCLUSION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    This email is 99.01% likely to be SPAM.
    â†’ Contains "FREE"     â†’ strongly spammy
    â†’ ALL CAPS subject    â†’ strongly spammy
    â†’ Not in contacts     â†’ strongly spammy
    â†’ All three features COMPOUND each other
    â†’ The product of likelihoods made the spam case overwhelming</code></pre></div>
<hr>
<h2>THE POWER OF MULTIPLE EVIDENCE â€” VISUAL</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>SINGLE FEATURE ANALYSIS (each alone):
</span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                              â”‚
â”‚  Using ONLY "FREE":                                         â”‚
â”‚      P(Spam|FREE) = (0.70Ã—0.20) / (0.70Ã—0.20+0.10Ã—0.80)   â”‚
â”‚                    = 0.14 / 0.22 = 0.6364 = 63.6%          â”‚
â”‚                                                              â”‚
â”‚  Using ONLY "ALL CAPS":                                     â”‚
â”‚      P(Spam|CAPS) = (0.60Ã—0.20) / (0.60Ã—0.20+0.05Ã—0.80)   â”‚
â”‚                    = 0.12 / 0.16 = 0.7500 = 75.0%          â”‚
â”‚                                                              â”‚
â”‚  Using ONLY "Not in contacts":                              â”‚
â”‚      P(Spam|Â¬Contact) = (0.95Ã—0.20)/(0.95Ã—0.20+0.20Ã—0.80) â”‚
â”‚                        = 0.19 / 0.35 = 0.5429 = 54.3%     â”‚
â”‚                                                              â”‚
â”‚  Using ALL THREE together:                                   â”‚
â”‚      P(Spam|All) = 99.01%                                   â”‚
â”‚                                                              â”‚
â”‚  PRIOR:                     20.0%  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘               â”‚
â”‚  After "FREE" alone:        63.6%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          â”‚
â”‚  After "CAPS" alone:        75.0%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ        â”‚
â”‚  After "Â¬Contact" alone:    54.3%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ             â”‚
â”‚  After ALL THREE:           99.0%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚
â”‚                                                              â”‚
â”‚  MULTIPLE FEATURES COMPOUND â†’ MUCH STRONGER CONCLUSION      â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre></div>
<hr>
<h2>WHY THE ASSUMPTION IS CALLED "NAIVE"</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>THE NAIVE PART:
</span>
    We assumed: P("FREE", "CAPS", "Â¬Contact" | Spam) 
              = P("FREE"|Spam) Ã— P("CAPS"|Spam) Ã— P("Â¬Contact"|Spam)

    IN REALITY:
        â†’ Spam emails with "FREE" might be MORE likely to also have "CAPS"
        â†’ These features may be CORRELATED even within the spam class
        â†’ A Nigerian prince email has BOTH "FREE" and "CAPS" together
        â†’ Our assumption IGNORES this correlation

    THE SURPRISING TRUTH:
        â†’ Despite being "wrong," Naive Bayes works EXTREMELY well
        â†’ The RANKING of classes is often correct even if exact 
          probabilities are off
        â†’ P(Spam|E) = 99.01% might really be 97% or 99.5%
        â†’ But the DECISION (classify as spam) is the same
        â†’ Naive Bayes is wrong on probabilities, right on decisions

    WHY IT WORKS DESPITE BEING WRONG:
        â†’ The denominator normalizes everything
        â†’ Correlated features over-count evidence for BOTH classes
        â†’ The over-counting partially CANCELS OUT in the ratio
        â†’ Classification accuracy remains high
        â†’ This is one of the great surprises of machine learning</code></pre></div>
<hr>
<h2>WHAT COULD BE DONE</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>â†’ Add MORE features (links count, attachment type, time sent, etc.)
</span>    â†’ Each feature MULTIPLIES into the likelihood
    â†’ More features â†’ more discriminative power
    â†’ But also more parameters to estimate

â†’ Handle MISSING features
    â†’ If a feature is unobserved, simply OMIT it from the product
    â†’ P(Eâ‚,Eâ‚ƒ|Spam) = P(Eâ‚|Spam) Ã— P(Eâ‚ƒ|Spam) â€” skip Eâ‚‚
    â†’ Naive Bayes handles missing data GRACEFULLY

â†’ Use LAPLACE SMOOTHING for zero probabilities
    â†’ If no spam email ever had feature X, P(X|Spam) = 0
    â†’ Entire product becomes 0 â†’ hypothesis killed permanently
    â†’ Fix: add a small count to every feature (covered in code below)</code></pre></div>
<hr>
<h2>WHAT SHOULD DO</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>âœ“ ALWAYS check for ZERO probabilities before multiplying
</span>    â†’ A single zero kills the entire product
    â†’ Apply Laplace smoothing (add 1 to numerator, add K to denominator)

âœ“ ALWAYS use LOG probabilities when features are many
    â†’ Multiplying 50 small probabilities â†’ numerical UNDERFLOW
    â†’ log(aÃ—bÃ—c) = log(a) + log(b) + log(c)
    â†’ Products become SUMS in log space
    â†’ Covered in detail in Problem 5

âœ“ ALWAYS verify the COMPLEMENT correctly
    â†’ If feature is ABSENT: use P(Eáµ¢=No|Class) = 1 - P(Eáµ¢=Yes|Class)
    â†’ Forgetting this is a common bug

âœ“ ALWAYS estimate likelihoods from SUFFICIENT data
    â†’ P(Feature|Class) estimated from 5 emails is unreliable
    â†’ Need at least ~30+ examples per feature per class</code></pre></div>
<hr>
<h2>WHAT SHOULD NOT DO</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>âœ— DO NOT use features that are DETERMINISTICALLY dependent
</span>    â†’ Feature A: "Contains FREE"
    â†’ Feature B: "Contains FREE or MONEY"
    â†’ If A=Yes then B=Yes always â†’ they are NOT independent
    â†’ Including both DOUBLE-COUNTS the evidence for "FREE"
    â†’ Posterior becomes overconfident

âœ— DO NOT ignore the ABSENCE of a feature
    â†’ Email does NOT contain "FREE" is ALSO evidence
    â†’ P("FREE"=No | Spam) = 0.30 is informative
    â†’ Absence of suspicious features supports Ham

âœ— DO NOT assume Naive Bayes posterior is a CALIBRATED probability
    â†’ 99.01% spam does not mean exactly 99.01 out of 100 similar emails are spam
    â†’ The independence assumption distorts exact probabilities
    â†’ Use it for RANKING and CLASSIFICATION, not for precise probability estimation
    â†’ If calibrated probabilities needed â†’ use Platt scaling or isotonic regression

âœ— DO NOT add redundant features thinking "more is always better"
    â†’ Redundant features violate independence MORE
    â†’ Can actually DECREASE performance
    â†’ Each feature should capture DIFFERENT information</code></pre></div>
<hr>
<h2>WHEN TO USE MULTIPLE-EVIDENCE BAYES (NAIVE BAYES)</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>âœ“ Text classification (spam, sentiment, topic)
</span>âœ“ Medical diagnosis with multiple symptoms
âœ“ Fraud detection with multiple transaction features
âœ“ Any classification where features are APPROXIMATELY independent given class
âœ“ When training data is LIMITED (Naive Bayes needs very little data)
âœ“ When you need a FAST, interpretable baseline
âœ“ When features are categorical or can be discretized</code></pre></div>
<hr>
<h2>WHEN NOT TO USE</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>âœ— When features are HIGHLY correlated given the class
</span>    â†’ Example: pixel values in images (neighboring pixels are very correlated)
    â†’ Use neural networks or tree-based methods instead

âœ— When you need PRECISE probability estimates
    â†’ Naive Bayes probabilities are systematically miscalibrated
    â†’ Tends to push probabilities toward 0 or 1 (overconfident)

âœ— When feature INTERACTIONS are crucial
    â†’ "FREE" alone is fine, "MONEY" alone is fine
    â†’ But "FREE MONEY" together is much more suspicious than either alone
    â†’ Naive Bayes cannot capture this interaction
    â†’ Need logistic regression or tree models for interactions</code></pre></div>
<hr>
<h2>HOW IT ONLY WORKS â€” INTERNAL MECHANICS</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>THE DECOMPOSITION TRICK:
</span>
    EXACT BAYES:
        P(H|Eâ‚,Eâ‚‚,...,Eâ‚˜) âˆ P(Eâ‚,Eâ‚‚,...,Eâ‚˜|H) Ã— P(H)

    The joint likelihood P(Eâ‚,Eâ‚‚,...,Eâ‚˜|H) requires exponential data.

    CHAIN RULE (exact but still hard):
        P(Eâ‚,Eâ‚‚,Eâ‚ƒ|H) = P(Eâ‚|H) Ã— P(Eâ‚‚|Eâ‚,H) Ã— P(Eâ‚ƒ|Eâ‚,Eâ‚‚,H)

    Each conditional depends on ALL previous features.
    Still need massive data.

    NAIVE ASSUMPTION (tractable):
        P(Eâ‚‚|Eâ‚,H) â‰ˆ P(Eâ‚‚|H)     â†’ Eâ‚ doesn't matter once H is known
        P(Eâ‚ƒ|Eâ‚,Eâ‚‚,H) â‰ˆ P(Eâ‚ƒ|H)  â†’ Eâ‚,Eâ‚‚ don't matter once H is known

    THEREFORE:
        P(Eâ‚,Eâ‚‚,Eâ‚ƒ|H) â‰ˆ P(Eâ‚|H) Ã— P(Eâ‚‚|H) Ã— P(Eâ‚ƒ|H)

    PARAMETERS NEEDED:
        Exact:  2á´¹ - 1 per class (exponential)
        Naive:  M per class (linear)

    FOR 50 FEATURES:
        Exact:  1,125,899,906,842,623 parameters per class
        Naive:  50 parameters per class
        Ratio:  22.5 TRILLION times fewer parameters


THE PRODUCT AS EVIDENCE ACCUMULATION:

    Each feature independently "votes":
        â†’ P(Eáµ¢|Spam) &gt; P(Eáµ¢|Ham)  â†’ feature votes FOR spam
        â†’ P(Eáµ¢|Spam) &lt; P(Eáµ¢|Ham)  â†’ feature votes AGAINST spam
        â†’ P(Eáµ¢|Spam) = P(Eáµ¢|Ham)  â†’ feature is NEUTRAL (no information)

    The product ACCUMULATES all votes.
    Strong features dominate.
    Neutral features contribute factor of 1 (no effect).
    Contradictory features partially cancel.

    
THE LIKELIHOOD RATIO VIEW:

    Instead of computing full posteriors, compare:

        Numerator_Spam     P(Spam)     P(Eâ‚|Spam)   P(Eâ‚‚|Spam)   P(Eâ‚ƒ|Spam)
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ = â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ã— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ã— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Ã— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        Numerator_Ham      P(Ham)      P(Eâ‚|Ham)    P(Eâ‚‚|Ham)    P(Eâ‚ƒ|Ham)

                         Prior Odds Ã— LRâ‚ Ã— LRâ‚‚ Ã— LRâ‚ƒ = Posterior Odds

    WHERE LRáµ¢ = P(Eáµ¢|Spam)/P(Eáµ¢|Ham) is the LIKELIHOOD RATIO for feature i

    FOR OUR PROBLEM:
        Prior Odds = 0.20/0.80 = 0.25

        LRâ‚ = 0.70/0.10 = 7.00   ("FREE" is 7Ã— more likely in spam)
        LRâ‚‚ = 0.60/0.05 = 12.00  ("CAPS" is 12Ã— more likely in spam)
        LRâ‚ƒ = 0.95/0.20 = 4.75   ("Â¬Contact" is 4.75Ã— more likely in spam)

        Posterior Odds = 0.25 Ã— 7.00 Ã— 12.00 Ã— 4.75
                       = 0.25 Ã— 399.00
                       = 99.75

        Posterior Probability = 99.75 / (1 + 99.75) = 0.99008 = 99.01%  âœ“

    THIS ODDS FORM IS ELEGANT:
        â†’ Each feature MULTIPLIES the odds
        â†’ LR &gt; 1 â†’ increases odds of spam
        â†’ LR &lt; 1 â†’ decreases odds of spam
        â†’ LR = 1 â†’ no effect</code></pre></div>
<hr>
<h2>THE LIKELIHOOD RATIO TABLE â€” WHICH FEATURES MATTER MOST</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span>â”‚  Feature            â”‚ P(E|Spam)  â”‚ P(E|Ham) â”‚   LR     â”‚  Interpretation     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ "FREE" present      â”‚   0.70     â”‚   0.10   â”‚   7.00   â”‚ Strong spam signal  â”‚
â”‚ ALL CAPS            â”‚   0.60     â”‚   0.05   â”‚  12.00   â”‚ Strongest signal    â”‚
â”‚ Not in contacts     â”‚   0.95     â”‚   0.20   â”‚   4.75   â”‚ Moderate signal     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ COMBINED            â”‚            â”‚          â”‚  399.00  â”‚ Overwhelming spam   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ALL CAPS alone is the MOST discriminative feature (LR=12).
But ALL THREE together create a combined LR of 399.
This is the COMPOUNDING POWER of multiple evidence.</code></pre></div>
<hr>
<h2>COMMON PITFALLS AND FAILURE MODES</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>PITFALL 1: THE ZERO-FREQUENCY PROBLEM
</span>    â†’ No spam email in training data contained "SCHOLARSHIP"
    â†’ P("SCHOLARSHIP"|Spam) = 0
    â†’ Product becomes: 0.70 Ã— 0.60 Ã— 0 = 0
    â†’ Entire spam probability collapses to ZERO
    â†’ One unseen feature VETOES all other evidence
    â†’ FIX: Laplace smoothing (add pseudocounts)

    WITHOUT SMOOTHING:  P(word|Spam) = count(word in spam) / count(spam)
    WITH SMOOTHING:     P(word|Spam) = (count(word in spam) + Î±) / (count(spam) + Î±Ã—V)
    
    WHERE:
        Î± = smoothing parameter (usually 1)
        V = vocabulary size (number of unique features)

PITFALL 2: NUMERICAL UNDERFLOW
    â†’ 100 features each with P(Eáµ¢|Class) â‰ˆ 0.01
    â†’ Product: 0.01Â¹â°â° = 10â»Â²â°â°
    â†’ Computer stores this as 0.0 (underflow)
    â†’ BOTH numerators become 0 â†’ division 0/0 â†’ crash
    â†’ FIX: Work in LOG SPACE (Problem 5)

PITFALL 3: CORRELATED FEATURES CAUSING OVERCONFIDENCE
    â†’ Including "contains FREE" AND "contains free" (case variants)
    â†’ They are perfectly correlated â†’ evidence counted TWICE
    â†’ Posterior pushed to extreme (99.99% instead of 95%)
    â†’ FIX: Feature engineering to remove redundancy

PITFALL 4: IMBALANCED PRIORS OVERWHELMING EVIDENCE
    â†’ If P(Spam) = 0.001 (very rare spam)
    â†’ Even strong features might not overcome the tiny prior
    â†’ This is CORRECT Bayesian behavior (recall Problem 1)
    â†’ But may not be the desired system behavior
    â†’ FIX: Adjust prior or use a classification threshold</code></pre></div>
<hr>
<h2>SCALABILITY CONSIDERATIONS</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>TRAINING:
</span>    â†’ Need to compute P(Eáµ¢|Class) for each feature Ã— each class
    â†’ M features Ã— K classes = MÃ—K parameters
    â†’ LINEAR in features, LINEAR in classes
    â†’ Can train on MILLIONS of emails in seconds
    â†’ One of the FASTEST classifiers to train

PREDICTION:
    â†’ For each new email: M multiplications Ã— K classes
    â†’ O(MÃ—K) per prediction
    â†’ Extremely fast â€” microseconds per email

STORAGE:
    â†’ Store MÃ—K probability values
    â†’ For 50,000 word vocabulary Ã— 2 classes = 100,000 numbers
    â†’ Trivial storage

COMPARED TO OTHER CLASSIFIERS:
    â†’ Neural Networks: millions of parameters, GPU needed
    â†’ Random Forests: thousands of trees, moderate memory
    â†’ Naive Bayes: MÃ—K numbers, runs on a calculator
    â†’ THIS is why Naive Bayes is the go-to BASELINE</code></pre></div>
<hr>
<h2>INTERPRETABILITY CONSIDERATIONS</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>FULLY TRANSPARENT:
</span>    â†’ Every feature's contribution is a SINGLE likelihood ratio
    â†’ Can sort features by LR to find most important
    â†’ Can explain EXACTLY why an email was classified as spam:
        "Because it contains FREE (7Ã— more likely in spam),
         has ALL CAPS subject (12Ã— more likely in spam),
         and sender is unknown (4.75Ã— more likely in spam)"
    â†’ No black box â€” complete audit trail

COMPARED TO DEEP LEARNING:
    â†’ Neural network says "spam" with no explanation
    â†’ Naive Bayes says "spam BECAUSE of features X, Y, Z 
      with contributions 7Ã—, 12Ã—, 4.75Ã—"
    â†’ In regulated industries (healthcare, finance), 
      this explainability is REQUIRED

LIMITATION:
    â†’ Cannot explain feature INTERACTIONS
    â†’ "FREE MONEY is suspicious" cannot be captured
    â†’ Only individual feature contributions are visible</code></pre></div>
<hr>
<h2>COMPLETE WORKING CODE</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># PROBLEM 3: THE SPAM DETECTOR</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Multiple Evidence Bayes â€” Naive Bayes from Scratch</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Builds on: Problem 1 (binary), Problem 2 (multi-hypothesis)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># NEW: Multiple features + Conditional Independence</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">import</span><span> math
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># SECTION 1: MANUAL CALCULATION (matching our hand computation)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"="</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"NAIVE BAYES SPAM DETECTOR â€” MANUAL CALCULATION"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"="</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- PRIORS (same concept as Problem 1) ----</span><span>
</span><span>p_spam </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.20</span><span>
</span><span>p_ham </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.80</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- INDIVIDUAL LIKELIHOODS ----</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Format: {feature_name: (P(feature=Yes|Spam), P(feature=Yes|Ham))}</span><span>
</span><span>feature_likelihoods </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"Contains FREE"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>    </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(54, 172, 170);">0.70</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.10</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"ALL CAPS subject"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(54, 172, 170);">0.60</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.05</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"In contacts"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>      </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(54, 172, 170);">0.05</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.80</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span></span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- OBSERVED EVIDENCE ----</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># True = feature is present, False = feature is absent</span><span>
</span><span>observed </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"Contains FREE"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>    </span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"ALL CAPS subject"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"In contacts"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>      </span><span class="token" style="color: rgb(54, 172, 170);">False</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>   </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># NOT in contacts</span><span>
</span><span></span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- STEP 1: Compute individual likelihood values for this email ----</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"\nSTEP 1: Individual Likelihoods for Observed Evidence"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"-"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'Feature'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&lt;25</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'Observed'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;10</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'P(obs|Spam)'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;14</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'P(obs|Ham)'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;14</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'LR'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;8</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"-"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span>spam_likelihoods </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">[</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span>
</span><span>ham_likelihoods </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">[</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span>
</span><span>likelihood_ratios </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">[</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> feature</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> is_present </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> observed</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>items</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    p_yes_spam</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> p_yes_ham </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> feature_likelihoods</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span>feature</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span>
</span>
<span>    </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> is_present</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        p_obs_spam </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> p_yes_spam
</span><span>        p_obs_ham </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> p_yes_ham
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">else</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Feature is ABSENT â†’ use complement</span><span>
</span><span>        p_obs_spam </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">-</span><span> p_yes_spam
</span><span>        p_obs_ham </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">-</span><span> p_yes_ham
</span>
<span>    lr </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> p_obs_spam </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> p_obs_ham
</span><span>    spam_likelihoods</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>append</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>p_obs_spam</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    ham_likelihoods</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>append</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>p_obs_ham</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    likelihood_ratios</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>append</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>lr</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span>    obs_str </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"Yes"</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> is_present </span><span class="token" style="color: rgb(0, 0, 255);">else</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"No"</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">feature</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&lt;25</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">obs_str</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;10</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">p_obs_spam</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;14.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">p_obs_ham</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;14.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">lr</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;8.2f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- STEP 2: Compute JOINT likelihoods (product â€” the NAIVE assumption) ----</span><span>
</span><span>joint_spam </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1.0</span><span>
</span><span>joint_ham </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1.0</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> ls </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> spam_likelihoods</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    joint_spam </span><span class="token" style="color: rgb(57, 58, 52);">*=</span><span> ls
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> lh </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> ham_likelihoods</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    joint_ham </span><span class="token" style="color: rgb(57, 58, 52);">*=</span><span> lh
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\n</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'JOINT (product)'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&lt;25</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">''</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;10</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">joint_spam</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;14.6f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">joint_ham</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;14.6f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- STEP 3: Compute numerators (same as Problem 2) ----</span><span>
</span><span>num_spam </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> p_spam </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> joint_spam
</span><span>num_ham </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> p_ham </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> joint_ham
</span><span>denominator </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> num_spam </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> num_ham
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nSTEP 2: Numerators"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Numerator_Spam = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">p_spam</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> Ã— </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">joint_spam</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.6f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">num_spam</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.8f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Numerator_Ham  = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">p_ham</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> Ã— </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">joint_ham</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.6f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">num_ham</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.8f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Denominator    = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">num_spam</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.8f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> + </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">num_ham</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.8f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">denominator</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.8f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- STEP 4: Compute posteriors ----</span><span>
</span><span>post_spam </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> num_spam </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> denominator
</span><span>post_ham </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> num_ham </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> denominator
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nSTEP 3: Posteriors"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  P(Spam|Evidence) = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">num_spam</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.8f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> / </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">denominator</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.8f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">post_spam</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.5f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">post_spam</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">*</span><span class="token string-interpolation interpolation" style="color: rgb(54, 172, 170);">100</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">%"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  P(Ham|Evidence)  = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">num_ham</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.8f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> / </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">denominator</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.8f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">post_ham</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.5f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">post_ham</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">*</span><span class="token string-interpolation interpolation" style="color: rgb(54, 172, 170);">100</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">%"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Sum check: </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">post_spam </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">+</span><span class="token string-interpolation interpolation"> post_ham</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.5f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> âœ“"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- STEP 5: Likelihood Ratio analysis ----</span><span>
</span><span>combined_lr </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1.0</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> lr </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> likelihood_ratios</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    combined_lr </span><span class="token" style="color: rgb(57, 58, 52);">*=</span><span> lr
</span>
<span>prior_odds </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> p_spam </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> p_ham
</span><span>posterior_odds </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> prior_odds </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> combined_lr
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nLIKELIHOOD RATIO ANALYSIS:"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Prior Odds (Spam:Ham)    = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">prior_odds</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Combined Likelihood Ratio = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">combined_lr</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Posterior Odds            = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">prior_odds</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> Ã— </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">combined_lr</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">posterior_odds</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Posterior Probability     = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">posterior_odds</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> / (1 + </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">posterior_odds</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">) = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">posterior_odds</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">/</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation interpolation" style="color: rgb(54, 172, 170);">1</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">+</span><span class="token string-interpolation interpolation">posterior_odds</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">)</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.5f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>

<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># SECTION 2: REUSABLE NAIVE BAYES CLASS</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"\n\n"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"="</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"REUSABLE NAIVE BAYES CLASSIFIER"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"="</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">class</span><span> </span><span class="token" style="color: rgb(43, 145, 175);">NaiveBayesClassifier</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    </span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">"""
</span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">    Binary Naive Bayes with Laplace smoothing.
</span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">    Trained from labeled examples.
</span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">    """</span><span>
</span>
<span>    </span><span class="token" style="color: rgb(0, 0, 255);">def</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">__init__</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>self</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> alpha</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span class="token" style="color: rgb(54, 172, 170);">1.0</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>alpha </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> alpha          </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Laplace smoothing parameter</span><span>
</span><span>        self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>class_counts </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>      </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># {class: count}</span><span>
</span><span>        self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>feature_counts </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>    </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># {class: {feature: count_present}}</span><span>
</span><span>        self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>total_count </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span>
</span><span>        self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>feature_names </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token builtin">set</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span>    </span><span class="token" style="color: rgb(0, 0, 255);">def</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">train</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>self</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> examples</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        </span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">"""
</span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">        examples: list of (features_dict, class_label)
</span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">        features_dict: {feature_name: True/False}
</span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">        """</span><span>
</span><span>        </span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> features</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> label </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> examples</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>            </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Count classes</span><span>
</span><span>            self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>class_counts</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>class_counts</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span>
</span><span>            self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>total_count </span><span class="token" style="color: rgb(57, 58, 52);">+=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span>
</span>
<span>            </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Count features per class</span><span>
</span><span>            </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> label </span><span class="token" style="color: rgb(0, 0, 255);">not</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>feature_counts</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>                self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>feature_counts</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>
</span>
<span>            </span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> fname</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> fval </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> features</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>items</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>                self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>feature_names</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>add</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>fname</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>                </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> fval</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>  </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Feature is present</span><span>
</span><span>                    self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>feature_counts</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span>fname</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> \
</span><span>                        self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>feature_counts</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>fname</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span>
</span>
<span>    </span><span class="token" style="color: rgb(0, 0, 255);">def</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">get_prior</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>self</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> label</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        </span><span class="token" style="color: rgb(0, 0, 255);">return</span><span> self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>class_counts</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>total_count
</span>
<span>    </span><span class="token" style="color: rgb(0, 0, 255);">def</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">get_likelihood</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>self</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> feature</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> value</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> label</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        </span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">"""P(feature=value | label) with Laplace smoothing"""</span><span>
</span><span>        count_present </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>feature_counts</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span class="token" style="color: rgb(57, 58, 52);">}</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>feature</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>        count_class </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>class_counts</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span>
</span>
<span>        </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Laplace smoothing: add alpha to numerator, 2*alpha to denominator</span><span>
</span><span>        p_present </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>count_present </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>alpha</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>count_class </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">2</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>alpha</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span>        </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> value</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>            </span><span class="token" style="color: rgb(0, 0, 255);">return</span><span> p_present
</span><span>        </span><span class="token" style="color: rgb(0, 0, 255);">else</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>            </span><span class="token" style="color: rgb(0, 0, 255);">return</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">-</span><span> p_present
</span>
<span>    </span><span class="token" style="color: rgb(0, 0, 255);">def</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">predict</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>self</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> features</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> explain</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span class="token" style="color: rgb(54, 172, 170);">False</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        </span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">"""
</span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">        Predict class for a new example.
</span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">        Returns: (predicted_class, posterior_dict, explanation)
</span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">        """</span><span>
</span><span>        scores </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>
</span><span>        explanations </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>
</span>
<span>        </span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> label </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>class_counts</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>            </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Start with log prior</span><span>
</span><span>            log_score </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> math</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>log</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get_prior</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>            feature_details </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">[</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span>
</span>
<span>            </span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> fname</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> fval </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> features</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>items</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>                likelihood </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> self</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get_likelihood</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>fname</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> fval</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> label</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>                log_score </span><span class="token" style="color: rgb(57, 58, 52);">+=</span><span> math</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>log</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>likelihood</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>                feature_details</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>append</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>fname</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> fval</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> likelihood</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span>            scores</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> log_score
</span><span>            explanations</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> feature_details
</span>
<span>        </span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Convert log scores to probabilities (log-sum-exp trick)</span><span>
</span><span>        max_score </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token builtin">max</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>scores</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>values</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>        exp_scores </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span> math</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>exp</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>score </span><span class="token" style="color: rgb(57, 58, 52);">-</span><span> max_score</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>                      </span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> label</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> score </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> scores</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>items</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>
</span><span>        total_exp </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token builtin">sum</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>exp_scores</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>values</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>        posteriors </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span>label</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span> exp_s </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> total_exp
</span><span>                      </span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> label</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> exp_s </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> exp_scores</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>items</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>
</span>
<span>        predicted </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token builtin">max</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>posteriors</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> key</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span>posteriors</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span>        </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> explain</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>            </span><span class="token" style="color: rgb(0, 0, 255);">return</span><span> predicted</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> posteriors</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> explanations
</span><span>        </span><span class="token" style="color: rgb(0, 0, 255);">return</span><span> predicted</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> posteriors
</span>

<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># SECTION 3: TRAIN AND TEST WITH SIMULATED DATA</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"\nGenerating training data from known distributions..."</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">import</span><span> random
</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>seed</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(54, 172, 170);">42</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">def</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">generate_email</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>is_spam</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    </span><span class="token triple-quoted-string" style="color: rgb(163, 21, 21);">"""Generate one email based on known feature distributions"""</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> is_spam</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        features </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span>
</span><span>            </span><span class="token" style="color: rgb(163, 21, 21);">"contains_FREE"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>    random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&lt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.70</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>            </span><span class="token" style="color: rgb(163, 21, 21);">"all_caps_subject"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span> random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&lt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.60</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>            </span><span class="token" style="color: rgb(163, 21, 21);">"in_contacts"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>      random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&lt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.05</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>            </span><span class="token" style="color: rgb(163, 21, 21);">"has_links"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>        random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&lt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.80</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>            </span><span class="token" style="color: rgb(163, 21, 21);">"has_attachment"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>   random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&lt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.30</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>        </span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>
</span><span>        label </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"SPAM"</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">else</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        features </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span>
</span><span>            </span><span class="token" style="color: rgb(163, 21, 21);">"contains_FREE"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>    random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&lt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.10</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>            </span><span class="token" style="color: rgb(163, 21, 21);">"all_caps_subject"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span> random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&lt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.05</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>            </span><span class="token" style="color: rgb(163, 21, 21);">"in_contacts"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>      random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&lt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.80</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>            </span><span class="token" style="color: rgb(163, 21, 21);">"has_links"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>        random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&lt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.30</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>            </span><span class="token" style="color: rgb(163, 21, 21);">"has_attachment"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>   random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&lt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.40</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>        </span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>
</span><span>        label </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"HAM"</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">return</span><span> features</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> label
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Generate training set</span><span>
</span><span>training_data </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">[</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> _ </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> </span><span class="token builtin">range</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(54, 172, 170);">2000</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    training_data</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>append</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>generate_email</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>is_spam</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> _ </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> </span><span class="token builtin">range</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(54, 172, 170);">8000</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    training_data</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>append</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>generate_email</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>is_spam</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span class="token" style="color: rgb(54, 172, 170);">False</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>shuffle</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>training_data</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"Training set size: </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation interpolation">training_data</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">)</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"Spam: </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation builtin">sum</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation interpolation" style="color: rgb(54, 172, 170);">1</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation" style="color: rgb(0, 0, 255);">for</span><span class="token string-interpolation interpolation"> _</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">,</span><span class="token string-interpolation interpolation"> l </span><span class="token string-interpolation interpolation" style="color: rgb(0, 0, 255);">in</span><span class="token string-interpolation interpolation"> training_data </span><span class="token string-interpolation interpolation" style="color: rgb(0, 0, 255);">if</span><span class="token string-interpolation interpolation"> l </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">==</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'SPAM'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">)</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"Ham:  </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation builtin">sum</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation interpolation" style="color: rgb(54, 172, 170);">1</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation" style="color: rgb(0, 0, 255);">for</span><span class="token string-interpolation interpolation"> _</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">,</span><span class="token string-interpolation interpolation"> l </span><span class="token string-interpolation interpolation" style="color: rgb(0, 0, 255);">in</span><span class="token string-interpolation interpolation"> training_data </span><span class="token string-interpolation interpolation" style="color: rgb(0, 0, 255);">if</span><span class="token string-interpolation interpolation"> l </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">==</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'HAM'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">)</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Train classifier</span><span>
</span><span>clf </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> NaiveBayesClassifier</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>alpha</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span class="token" style="color: rgb(54, 172, 170);">1.0</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>clf</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>train</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>training_data</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- Show learned parameters ----</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"\n"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"-"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"LEARNED PARAMETERS:"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"-"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'Feature'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&lt;25</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'P(F=Yes|SPAM)'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;15</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'P(F=Yes|HAM)'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;15</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'LR'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;8</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"-"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> fname </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> </span><span class="token builtin">sorted</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>clf</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>feature_names</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    p_spam_f </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> clf</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get_likelihood</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>fname</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"SPAM"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    p_ham_f </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> clf</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get_likelihood</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>fname</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"HAM"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    lr </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> p_spam_f </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> p_ham_f </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> p_ham_f </span><span class="token" style="color: rgb(57, 58, 52);">&gt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">else</span><span> </span><span class="token builtin">float</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">'inf'</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">fname</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&lt;25</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">p_spam_f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;15.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">p_ham_f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;15.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">lr</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;8.2f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nPrior P(SPAM) = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">clf</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">.</span><span class="token string-interpolation interpolation">get_prior</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'SPAM'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">)</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"Prior P(HAM)  = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">clf</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">.</span><span class="token string-interpolation interpolation">get_prior</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'HAM'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">)</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- Test with our original email ----</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"\n"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"="</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"CLASSIFYING THE ORIGINAL EMAIL"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"="</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span>test_email </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">{</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"contains_FREE"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>    </span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"all_caps_subject"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"in_contacts"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>      </span><span class="token" style="color: rgb(54, 172, 170);">False</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"has_links"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>        </span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span>    </span><span class="token" style="color: rgb(163, 21, 21);">"has_attachment"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>   </span><span class="token" style="color: rgb(54, 172, 170);">False</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span>
</span><span></span><span class="token" style="color: rgb(57, 58, 52);">}</span><span>
</span>
<span>predicted</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> posteriors</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> explanations </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> clf</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>predict</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>test_email</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> explain</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nObserved features:"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> fname</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> fval </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> test_email</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>items</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">fname</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&lt;25</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'Yes'</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation" style="color: rgb(0, 0, 255);">if</span><span class="token string-interpolation interpolation"> fval </span><span class="token string-interpolation interpolation" style="color: rgb(0, 0, 255);">else</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation" style="color: rgb(163, 21, 21);">'No'</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nPosterior probabilities:"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> label</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> post </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> </span><span class="token builtin">sorted</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>posteriors</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>items</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> key</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span class="token" style="color: rgb(0, 0, 255);">lambda</span><span> x</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">-</span><span>x</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span class="token" style="color: rgb(54, 172, 170);">1</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    bar </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"â–ˆ"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token builtin">int</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>post </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">50</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">label</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&lt;8</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">post</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;8.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> (</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">post</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">*</span><span class="token string-interpolation interpolation" style="color: rgb(54, 172, 170);">100</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">%)  </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">bar</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nâ†’ CLASSIFICATION: </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">predicted</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ---- Show per-feature contribution ----</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nFeature contributions for SPAM:"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> fname</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> fval</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> likelihood </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> explanations</span><span class="token" style="color: rgb(57, 58, 52);">[</span><span class="token" style="color: rgb(163, 21, 21);">"SPAM"</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    ham_likelihood </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> clf</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get_likelihood</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>fname</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> fval</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"HAM"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    lr </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> likelihood </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> ham_likelihood </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> ham_likelihood </span><span class="token" style="color: rgb(57, 58, 52);">&gt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">else</span><span> </span><span class="token builtin">float</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">'inf'</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    direction </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"â†’ supports SPAM"</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> lr </span><span class="token" style="color: rgb(57, 58, 52);">&gt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">else</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"â†’ supports HAM"</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">fname</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&lt;25</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> P(obs|SPAM)=</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">likelihood</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">  "</span><span>
</span><span>          </span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"P(obs|HAM)=</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">ham_likelihood</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">  LR=</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">lr</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">  </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">direction</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>

<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># SECTION 4: EVALUATE ON TEST SET</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"\n\n"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"="</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"EVALUATION ON FRESH TEST DATA"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"="</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Generate test set</span><span>
</span><span>test_data </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">[</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> _ </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> </span><span class="token builtin">range</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(54, 172, 170);">500</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    test_data</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>append</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>generate_email</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>is_spam</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> _ </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> </span><span class="token builtin">range</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(54, 172, 170);">2000</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    test_data</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>append</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>generate_email</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>is_spam</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span class="token" style="color: rgb(54, 172, 170);">False</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>random</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>shuffle</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>test_data</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Classify all test emails</span><span>
</span><span>correct </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span>
</span><span>true_pos </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span>
</span><span>false_pos </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span>
</span><span>true_neg </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span>
</span><span>false_neg </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> features</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> true_label </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> test_data</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    pred</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> _ </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> clf</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>predict</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>features</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> pred </span><span class="token" style="color: rgb(57, 58, 52);">==</span><span> true_label</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        correct </span><span class="token" style="color: rgb(57, 58, 52);">+=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> pred </span><span class="token" style="color: rgb(57, 58, 52);">==</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"SPAM"</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">and</span><span> true_label </span><span class="token" style="color: rgb(57, 58, 52);">==</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"SPAM"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        true_pos </span><span class="token" style="color: rgb(57, 58, 52);">+=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">elif</span><span> pred </span><span class="token" style="color: rgb(57, 58, 52);">==</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"SPAM"</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">and</span><span> true_label </span><span class="token" style="color: rgb(57, 58, 52);">==</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"HAM"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        false_pos </span><span class="token" style="color: rgb(57, 58, 52);">+=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">elif</span><span> pred </span><span class="token" style="color: rgb(57, 58, 52);">==</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"HAM"</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">and</span><span> true_label </span><span class="token" style="color: rgb(57, 58, 52);">==</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"HAM"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        true_neg </span><span class="token" style="color: rgb(57, 58, 52);">+=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">elif</span><span> pred </span><span class="token" style="color: rgb(57, 58, 52);">==</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"HAM"</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">and</span><span> true_label </span><span class="token" style="color: rgb(57, 58, 52);">==</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"SPAM"</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>        false_neg </span><span class="token" style="color: rgb(57, 58, 52);">+=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1</span><span>
</span>
<span>accuracy </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> correct </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> </span><span class="token builtin">len</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>test_data</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>precision </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> true_pos </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>true_pos </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> false_pos</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>true_pos </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> false_pos</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&gt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">else</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span>
</span><span>recall </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> true_pos </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>true_pos </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> false_neg</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>true_pos </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> false_neg</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&gt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">else</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span>
</span><span>f1 </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">2</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> precision </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> recall </span><span class="token" style="color: rgb(57, 58, 52);">/</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>precision </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> recall</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">if</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>precision </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> recall</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">&gt;</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span> </span><span class="token" style="color: rgb(0, 0, 255);">else</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nTest set size: </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation builtin">len</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation interpolation">test_data</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">)</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nConfusion Matrix:"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"                    Predicted SPAM    Predicted HAM"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Actual SPAM       </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">true_pos</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;10</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">        </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">false_neg</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;10</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Actual HAM        </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">false_pos</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;10</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">        </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">true_neg</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&gt;10</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\nMetrics:"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Accuracy:  </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">accuracy</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> (</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">accuracy</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">*</span><span class="token string-interpolation interpolation" style="color: rgb(54, 172, 170);">100</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.1f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">%)"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Precision: </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">precision</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> (of those we called spam, how many truly were)"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  Recall:    </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">recall</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> (of actual spam, how many did we catch)"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  F1 Score:  </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">f1</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.4f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>

<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># SECTION 5: THE ZERO-FREQUENCY PROBLEM DEMONSTRATION</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># ============================================================</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"\n\n"</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">+</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"="</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"DEMONSTRATION: THE ZERO-FREQUENCY PROBLEM"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"="</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">*</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">70</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"\nWithout Laplace smoothing (alpha=0):"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>clf_no_smooth </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> NaiveBayesClassifier</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>alpha</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span class="token" style="color: rgb(54, 172, 170);">0.0</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>clf_no_smooth</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>train</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>training_data</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Create email with a feature that was NEVER seen in spam training data</span><span>
</span><span></span><span class="token" style="color: rgb(0, 128, 0); font-style: italic;"># Simulating: what if "in_contacts" was True for ALL spam? (unlikely but illustrative)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"  If a feature has P(F|Class) = 0, entire product collapses"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"  Laplace smoothing prevents this by adding pseudocounts"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"\n  With alpha=0: P('in_contacts'=Yes|SPAM) might be very small"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span></span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  With alpha=1: P('in_contacts'=Yes|SPAM) gets a safety floor"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span>
<span></span><span class="token" style="color: rgb(0, 0, 255);">for</span><span> alpha_val </span><span class="token" style="color: rgb(0, 0, 255);">in</span><span> </span><span class="token" style="color: rgb(57, 58, 52);">[</span><span class="token" style="color: rgb(54, 172, 170);">0.001</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.01</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">0.1</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">1.0</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">10.0</span><span class="token" style="color: rgb(57, 58, 52);">]</span><span class="token" style="color: rgb(57, 58, 52);">:</span><span>
</span><span>    clf_test </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> NaiveBayesClassifier</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>alpha</span><span class="token" style="color: rgb(57, 58, 52);">=</span><span>alpha_val</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    clf_test</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>train</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span>training_data</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    p </span><span class="token" style="color: rgb(57, 58, 52);">=</span><span> clf_test</span><span class="token" style="color: rgb(57, 58, 52);">.</span><span>get_likelihood</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token" style="color: rgb(163, 21, 21);">"in_contacts"</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(54, 172, 170);">True</span><span class="token" style="color: rgb(57, 58, 52);">,</span><span> </span><span class="token" style="color: rgb(163, 21, 21);">"SPAM"</span><span class="token" style="color: rgb(57, 58, 52);">)</span><span>
</span><span>    </span><span class="token" style="color: rgb(0, 0, 255);">print</span><span class="token" style="color: rgb(57, 58, 52);">(</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">f"  alpha=</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">alpha_val</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">&lt;6</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);"> â†’ P(in_contacts=Yes|SPAM) = </span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">{</span><span class="token string-interpolation interpolation">p</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">:</span><span class="token string-interpolation interpolation format-spec">.6f</span><span class="token string-interpolation interpolation" style="color: rgb(57, 58, 52);">}</span><span class="token string-interpolation" style="color: rgb(163, 21, 21);">"</span><span class="token" style="color: rgb(57, 58, 52);">)</span></code></pre></div>
<hr>
<h2>EXPECTED OUTPUT (KEY SECTIONS)</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>======================================================================
</span>NAIVE BAYES SPAM DETECTOR â€” MANUAL CALCULATION
======================================================================

STEP 1: Individual Likelihoods for Observed Evidence
----------------------------------------------------------------------
Feature                   Observed   P(obs|Spam)   P(obs|Ham)       LR
----------------------------------------------------------------------
Contains FREE                  Yes         0.7000       0.1000     7.00
ALL CAPS subject               Yes         0.6000       0.0500    12.00
In contacts                     No         0.9500       0.2000     4.75
JOINT (product)                            0.399000     0.001000

STEP 3: Posteriors
  P(Spam|Evidence) = 0.07980000 / 0.08060000 = 0.99008 = 99.01%
  P(Ham|Evidence)  = 0.00080000 / 0.08060000 = 0.00992 = 0.99%

â†’ CLASSIFICATION: SPAM

Metrics:
  Accuracy:  0.9536 (95.4%)
  Precision: 0.8712
  Recall:    0.8640
  F1 Score:  0.8676</code></pre></div>
<hr>
<h2>KEY TAKEAWAY FROM PROBLEM 3</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
</span>â”‚                                                                  â”‚
â”‚  LESSON: Multiple evidence features COMPOUND through products.  â”‚
â”‚                                                                  â”‚
â”‚  FROM PROBLEM 1:                                                 â”‚
â”‚  â†’ Same P(A|B) = P(B|A)P(A)/P(B) structure                     â”‚
â”‚  â†’ Same binary classification framework                         â”‚
â”‚                                                                  â”‚
â”‚  FROM PROBLEM 2:                                                 â”‚
â”‚  â†’ Same denominator = sum over all hypotheses pattern            â”‚
â”‚  â†’ Same numerator table approach                                 â”‚
â”‚                                                                  â”‚
â”‚  NEW IN THIS PROBLEM:                                            â”‚
â”‚  â†’ CONDITIONAL INDEPENDENCE assumption                           â”‚
â”‚    â†’ Joint likelihood = PRODUCT of individual likelihoods        â”‚
â”‚    â†’ Reduces exponential parameters to linear                    â”‚
â”‚  â†’ LIKELIHOOD RATIO view                                         â”‚
â”‚    â†’ Each feature multiplies the odds                            â”‚
â”‚    â†’ Features "vote" for or against each hypothesis              â”‚
â”‚  â†’ LAPLACE SMOOTHING                                             â”‚
â”‚    â†’ Prevents zero-frequency catastrophe                         â”‚
â”‚  â†’ LOG SPACE computation (previewed, detailed in Problem 5)      â”‚
â”‚                                                                  â”‚
â”‚  THE "NAIVE" LABEL IS MISLEADING:                                â”‚
â”‚  â†’ The assumption is often wrong                                 â”‚
â”‚  â†’ But the classifier is often RIGHT                             â”‚
â”‚  â†’ Simple, fast, interpretable, effective                        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre></div>
<hr>
<h2>ğŸŒ‰ BRIDGE TO PROBLEM 4</h2>
<div class="relative"><pre style="color: rgb(57, 58, 52); font-family: Consolas, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace; direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; font-size: 0.9em; line-height: 1.2em; tab-size: 4; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border: 1px solid rgb(221, 221, 221); background-color: white;"><code style="white-space: pre-wrap; word-break: break-all;"><span>WHAT WE MASTERED:
</span>    â†’ Problem 1: Binary Bayes (2 hypotheses, 1 evidence)
    â†’ Problem 2: Multi-hypothesis Bayes (N hypotheses, 1 evidence)
    â†’ Problem 3: Multiple evidence (2 hypotheses, M features, independence)

WHAT'S NEXT â€” THE COMBINATION:
    â†’ What if we have N hypotheses AND M features?
    â†’ A patient has 5 symptoms. Which of 4 diseases is most likely?
    â†’ This combines Problem 2's multi-hypothesis framework
      with Problem 3's multiple-feature products

PROBLEM 4: The Medical Differential Diagnosis
    â†’ Patient presents with: fever, cough, fatigue, no rash, no joint pain
    â†’ Possible diseases: Flu, COVID, Mono, Malaria
    â†’ Each disease has different symptom profiles
    â†’ Rank diseases by posterior probability
    â†’ Introduce the concept of DECISION MAKING under uncertainty</code></pre></div>
<hr>
</div>
</div>

<!-- ========== data-index="7" ========== -->

        </div>

        <div class="nav-bar">
            <a href="problem-2.html" class="nav-button prev">â† Previous Problem</a>
            <div class="page-info">
                <a href="index.html" class="nav-button home">ğŸ“š Table of Contents</a><br>
                <span style="margin-top:8px;display:block">Problem 3 of 9</span>
            </div>
            <a href="problem-4.html" class="nav-button next">Next Problem â†’</a>
        </div>
    </div>

    
    <div id="progress-track"><div id="progress-fill"></div></div>
    <div id="progress-pct">0%</div>


    <script>
    const fill = document.getElementById('progress-fill');
    const pct  = document.getElementById('progress-pct');
    function updateProgress() {
        const scrollTop = window.scrollY;
        const docHeight = document.body.scrollHeight - window.innerHeight;
        const scrolled  = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
        fill.style.height = scrolled + '%';
        pct.textContent   = Math.round(scrolled) + '%';
    }
    window.addEventListener('scroll', updateProgress);
    updateProgress();

    document.addEventListener('keydown', function(e) {
        if (['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) return;
        if (e.key === 'ArrowLeft') {
            const b = document.querySelector('.nav-button.prev');
            if (b && !b.classList.contains('disabled')) window.location.href = b.href;
        }
        if (e.key === 'ArrowRight') {
            const b = document.querySelector('.nav-button.next');
            if (b && !b.classList.contains('disabled')) window.location.href = b.href;
        }
    });
    </script>

</body>
</html>